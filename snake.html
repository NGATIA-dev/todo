<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Snake SPA</title>

<style>
:root {
  --bg: #ffffff;
  --text: #111;
  --board: #eaeaea;
  --snake: #2ecc71;
  --food: #e74c3c;
  --accent: #3498db;
}

body.dark {
  --bg: #121212;
  --text: #f5f5f5;
  --board: #1e1e1e;
  --snake: #2ecc71;
  --food: #ff7675;
  --accent: #74b9ff;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 { margin-top: 10px; }

.controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  max-width: 800px;
  width: 95%;
  margin: 10px 0;
}

.controls label {
  display: flex;
  flex-direction: column;
  font-size: 14px;
}

button {
  padding: 6px;
  cursor: pointer;
  border: none;
  background: var(--accent);
  color: white;
}

canvas {
  background: var(--board);
  margin: 10px 0;
}

.scoreboard {
  width: 95%;
  max-width: 600px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  border: 1px solid var(--text);
  padding: 6px;
  text-align: center;
}
</style>
</head>
<body>

<h1>Snake SPA</h1>

<div class="controls">
  <label>Player Name
    <input type="text" id="playerName" placeholder="Your name">
  </label>

  <label>Grid Size
    <input type="number" id="gridSize" value="20" min="10" max="50">
  </label>

  <label>Speed (ms per move)
    <input type="number" id="speed" value="150" min="50" max="500">
  </label>

  <label>Timed Trial (seconds)
    <input type="number" id="timeLimit" value="0" min="0" max="300">
  </label>

  <label><input type="checkbox" id="darkMode"> Dark Mode</label>
  <label><input type="checkbox" id="wallCollision" checked> Wall Collision</label>
  <label><input type="checkbox" id="selfCollision" checked> Self Collision</label>

  <button onclick="startGame()">Start</button>
  <button onclick="resetLeaderboard()">Reset Leaderboard</button>
</div>

<canvas id="gameCanvas" width="400" height="400"></canvas>

<div>
  <strong>Score:</strong> <span id="score">0</span>
  <span id="timerDisplay"></span>
</div>

<div class="scoreboard">
  <h2>Leaderboard</h2>
  <table>
    <thead>
      <tr><th>Name</th><th>Score</th><th>Date</th></tr>
    </thead>
    <tbody id="leaderboard"></tbody>
  </table>
</div>

<script>
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");

let snake, direction, food, gameInterval, score, gridSize, tileSize;
let speed, wallCollision, selfCollision, timeLimit, timer, timeLeft;

document.getElementById("darkMode").addEventListener("change", e => {
  document.body.classList.toggle("dark", e.target.checked);
});

function startGame() {
  gridSize = parseInt(document.getElementById("gridSize").value);
  speed = parseInt(document.getElementById("speed").value);
  wallCollision = document.getElementById("wallCollision").checked;
  selfCollision = document.getElementById("selfCollision").checked;
  timeLimit = parseInt(document.getElementById("timeLimit").value);

  canvas.width = canvas.height = 400;
  tileSize = canvas.width / gridSize;

  snake = [{x: 5, y: 5}];
  direction = {x: 1, y: 0};
  score = 0;
  document.getElementById("score").textContent = score;

  placeFood();
  clearInterval(gameInterval);
  clearInterval(timer);

  gameInterval = setInterval(update, speed);

  if (timeLimit > 0) {
    timeLeft = timeLimit;
    document.getElementById("timerDisplay").textContent = ` | Time: ${timeLeft}`;
    timer = setInterval(() => {
      timeLeft--;
      document.getElementById("timerDisplay").textContent = ` | Time: ${timeLeft}`;
      if (timeLeft <= 0) endGame();
    }, 1000);
  } else {
    document.getElementById("timerDisplay").textContent = "";
  }
}

function update() {
  let head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};

  if (!wallCollision) {
    head.x = (head.x + gridSize) % gridSize;
    head.y = (head.y + gridSize) % gridSize;
  } else {
    if (head.x < 0 || head.y < 0 || head.x >= gridSize || head.y >= gridSize)
      return endGame();
  }

  if (selfCollision && snake.some(seg => seg.x === head.x && seg.y === head.y))
    return endGame();

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    score++;
    document.getElementById("score").textContent = score;
    placeFood();
  } else {
    snake.pop();
  }

  draw();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--snake');
  snake.forEach(seg => {
    ctx.fillRect(seg.x * tileSize, seg.y * tileSize, tileSize, tileSize);
  });

  ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--food');
  ctx.fillRect(food.x * tileSize, food.y * tileSize, tileSize, tileSize);
}

function placeFood() {
  food = {
    x: Math.floor(Math.random() * gridSize),
    y: Math.floor(Math.random() * gridSize)
  };
}

function endGame() {
  clearInterval(gameInterval);
  clearInterval(timer);
  saveScore();
  alert("Game Over!");
}

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp" && direction.y === 0) direction = {x: 0, y: -1};
  if (e.key === "ArrowDown" && direction.y === 0) direction = {x: 0, y: 1};
  if (e.key === "ArrowLeft" && direction.x === 0) direction = {x: -1, y: 0};
  if (e.key === "ArrowRight" && direction.x === 0) direction = {x: 1, y: 0};
});

function saveScore() {
  let name = document.getElementById("playerName").value || "Anonymous";
  let scores = JSON.parse(localStorage.getItem("snakeScores") || "[]");
  scores.push({name, score, date: new Date().toLocaleString()});
  scores.sort((a,b) => b.score - a.score);
  localStorage.setItem("snakeScores", JSON.stringify(scores.slice(0, 20)));
  renderLeaderboard();
}

function renderLeaderboard() {
  let scores = JSON.parse(localStorage.getItem("snakeScores") || "[]");
  let tbody = document.getElementById("leaderboard");
  tbody.innerHTML = "";
  scores.forEach(s => {
    let row = `<tr>
      <td>${s.name}</td>
      <td>${s.score}</td>
      <td>${s.date}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

function resetLeaderboard() {
  localStorage.removeItem("snakeScores");
  renderLeaderboard();
}

renderLeaderboard();
</script>

</body>
</html>
