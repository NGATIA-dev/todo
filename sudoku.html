<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sudoku SPA</title>

<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
  }

  h1 { margin-bottom: 10px; }

  .controls {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }

  select, button {
    padding: 6px 10px;
    font-size: 14px;
    cursor: pointer;
  }

  #timer {
    font-weight: bold;
  }

  .board {
    display: grid;
    grid-template-columns: repeat(9, 45px);
    grid-template-rows: repeat(9, 45px);
  }

  .cell {
    width: 45px;
    height: 45px;
    text-align: center;
    font-size: 18px;
    border: 1px solid #999;
    outline: none;
  }

  .fixed {
    background: #ddd;
    font-weight: bold;
  }

  .error {
    background: #ffcccc;
  }

  /* Thick sector borders */
  .border-right { border-right: 3px solid black !important; }
  .border-bottom { border-bottom: 3px solid black !important; }
  .border-left { border-left: 3px solid black !important; }
  .border-top { border-top: 3px solid black !important; }

</style>
</head>
<body>

<h1>Sudoku SPA</h1>

<div class="controls">
  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
  </select>
  <button onclick="newGame()">New Game</button>
  <button onclick="resetGame()">Reset</button>
  <div>Time: <span id="timer">00:00</span></div>
</div>

<div class="board" id="board"></div>

<script>
const boardElement = document.getElementById("board");
const timerElement = document.getElementById("timer");

let state = {
  puzzle: [],
  solution: [],
  current: [],
  seconds: 0,
  timer: null
};

const difficultyLevels = {
  easy: 35,
  medium: 45,
  hard: 55
};

/* -----------------------------
   Sudoku Generator
----------------------------- */

function generateFullBoard() {
  const board = Array.from({ length: 9 }, () => Array(9).fill(0));
  solve(board);
  return board;
}

function solve(board) {
  for (let row = 0; row < 9; row++) {
    for (let col = 0; col < 9; col++) {
      if (board[row][col] === 0) {
        const nums = shuffle([1,2,3,4,5,6,7,8,9]);
        for (let num of nums) {
          if (isValid(board, row, col, num)) {
            board[row][col] = num;
            if (solve(board)) return true;
            board[row][col] = 0;
          }
        }
        return false;
      }
    }
  }
  return true;
}

function isValid(board, row, col, num) {
  for (let i = 0; i < 9; i++) {
    if (board[row][i] === num || board[i][col] === num) return false;
  }

  const boxRow = Math.floor(row / 3) * 3;
  const boxCol = Math.floor(col / 3) * 3;

  for (let r = 0; r < 3; r++)
    for (let c = 0; c < 3; c++)
      if (board[boxRow+r][boxCol+c] === num) return false;

  return true;
}

function countSolutions(board) {
  let count = 0;

  function solveCount(b) {
    for (let row = 0; row < 9; row++) {
      for (let col = 0; col < 9; col++) {
        if (b[row][col] === 0) {
          for (let num = 1; num <= 9; num++) {
            if (isValid(b, row, col, num)) {
              b[row][col] = num;
              solveCount(b);
              b[row][col] = 0;
            }
          }
          return;
        }
      }
    }
    count++;
  }

  solveCount(JSON.parse(JSON.stringify(board)));
  return count;
}

function removeNumbers(board, attempts) {
  while (attempts > 0) {
    let row = Math.floor(Math.random() * 9);
    let col = Math.floor(Math.random() * 9);

    if (board[row][col] !== 0) {
      const backup = board[row][col];
      board[row][col] = 0;

      if (countSolutions(board) !== 1) {
        board[row][col] = backup;
        attempts--;
      }
    }
  }
  return board;
}

function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

/* -----------------------------
   Game Control
----------------------------- */

function newGame() {
  const difficulty = document.getElementById("difficulty").value;
  const full = generateFullBoard();
  const puzzle = removeNumbers(
    JSON.parse(JSON.stringify(full)),
    difficultyLevels[difficulty]
  );

  state.solution = full;
  state.puzzle = puzzle;
  state.current = JSON.parse(JSON.stringify(puzzle));
  state.seconds = 0;

  startTimer();
  renderBoard();
  saveGame();
}

function resetGame() {
  state.current = JSON.parse(JSON.stringify(state.puzzle));
  renderBoard();
  saveGame();
}

function renderBoard() {
  boardElement.innerHTML = "";

  for (let row = 0; row < 9; row++) {
    for (let col = 0; col < 9; col++) {
      const input = document.createElement("input");
      input.classList.add("cell");

      if (row % 3 === 0) input.classList.add("border-top");
      if (col % 3 === 0) input.classList.add("border-left");
      if ((row + 1) % 3 === 0) input.classList.add("border-bottom");
      if ((col + 1) % 3 === 0) input.classList.add("border-right");

      if (state.puzzle[row][col] !== 0) {
        input.value = state.puzzle[row][col];
        input.disabled = true;
        input.classList.add("fixed");
      } else {
        input.value = state.current[row][col] || "";
        input.addEventListener("input", (e) => {
          const val = parseInt(e.target.value);
          if (val >= 1 && val <= 9) {
            state.current[row][col] = val;
          } else {
            state.current[row][col] = 0;
            e.target.value = "";
          }
          validateBoard();
          saveGame();
        });
      }

      boardElement.appendChild(input);
    }
  }
}

function validateBoard() {
  const cells = document.querySelectorAll(".cell");
  cells.forEach(c => c.classList.remove("error"));

  for (let r = 0; r < 9; r++) {
    for (let c = 0; c < 9; c++) {
      if (
        state.current[r][c] !== 0 &&
        state.current[r][c] !== state.solution[r][c]
      ) {
        cells[r * 9 + c].classList.add("error");
      }
    }
  }
}

function startTimer() {
  clearInterval(state.timer);
  state.timer = setInterval(() => {
    state.seconds++;
    updateTimer();
    saveGame();
  }, 1000);
}

function updateTimer() {
  const min = String(Math.floor(state.seconds / 60)).padStart(2, "0");
  const sec = String(state.seconds % 60).padStart(2, "0");
  timerElement.textContent = `${min}:${sec}`;
}

/* -----------------------------
   LocalStorage
----------------------------- */

function saveGame() {
  localStorage.setItem("sudokuGame", JSON.stringify(state));
}

function loadGame() {
  const saved = localStorage.getItem("sudokuGame");
  if (!saved) return false;

  state = JSON.parse(saved);
  renderBoard();
  startTimer();
  updateTimer();
  return true;
}

/* -----------------------------
   Init
----------------------------- */

if (!loadGame()) {
  newGame();
}

</script>
</body>
</html>
